#include "item.h"

#include <QDebug>

Item::Item()
{
    name_list[0]={-4590,-4340,6,"瓦尔纳黄金女性护身符","保加利亚的瓦尔纳考古遗址和杜兰库拉克新石器时代遗址出土的新石器时期晚期，到铜石并用的史前时期的黄金加工首饰。这些金首饰被考古学家认为属于迄今发掘出的最早的经过加工的黄金饰品，被称为“瓦尔纳黄金宝藏”。",1};
    name_list[1]={-4590,-4340,6,"瓦尔纳金珠","大多数瓦尔纳金器所采用了早期金器最常用的锤碟工艺，但也有部分使用了模铸法，甚至失蜡法。这批黄金饰物的发现使我们有理由认为，黄金冶炼与铜冶炼几乎在同时期出现。这样高超的黄金制作工艺，在目前考古学的证据链里空白了2000年。",1};
    name_list[2]={-4590,-4340,6,"瓦尔纳金臂镯","瓦尔纳宝藏的原料来自河床出产的砂金。《阿耳戈英雄》的神话传说中据考证，在科尔喀斯，黄金是山洪冲下来的，人们借助排水沟和羊皮获得黄金，这就是金羊毛神话的由来。科尔喀斯位于黑海东端，在今天的吉鲁吉亚共和国境内。当地人用羊毛淘金的方法，一直到苏联时期还在继续。",1};
    name_list[3]={-4590,-4340,5,"瓦尔纳陶鸟俑","用于某种宗教崇拜仪式。在铜石并用时代，原始社会逐渐解体，阶级、私有制和国家逐渐出现。瓦尔纳墓葬是人类社会出现等级制的重要证据，也是保加利亚从母系社会进入父系社会的证明。",1};
    name_list[4]={-4500,-3000,6,"红山文化陶熏炉器盖","出土于牛河梁遗址第一地点女神庙。泥质红陶，陶质较细，火候甚高，质地坚硬，薄厚均匀；形如倒置的豆，柄呈喇叭状，盖的沿腹间起明显折棱；盖面有四组长条状镂孔，每组5条，间距相等，以中间孔最长。",1};
    name_list[5]={-4500,-3000,6,"红山文化玉斜口筒形器","出土于牛河梁遗址第二地点一号冢25号墓。器表为青绿色，整体呈扁圆筒状。一端作斜口，口大而外敞；一端作平口，开口较小。上下口沿的沿面均磨平，或磨薄似刀刃。接近下口沿的长径两侧，有由外向内单面钻出的双孔，内壁可见掏取内芯时遗留的线切割痕迹。",1};
    name_list[6]={-3500,-3100,6,"古埃及彩绘双耳陶罐","古埃及的前王朝时期，通常被划分为涅伽达文化三阶段：第一阶段又叫「阿姆拉特时期」，第二阶段又叫「格尔津时期」，第三阶段被视为「第零王朝」。「格尔津时期」的墓葬中，被发掘出了许多带有暗红图案的棕黄陶罐。双耳陶罐上绘有一艘带有两个舱的大船，有桅杆和密集的竖桨，船头有棕榈树装饰。",1};
    name_list[7]={-2575,-2551,6,"古埃及美杜姆群鹅图","斯尼夫鲁是古埃及第四王朝的创立者，「美杜姆群鹅图」是他长子墓中墙面上的石膏装饰，是一幅完整壁画中的残片。壁画由工匠在墙面雕刻，再填以颜料。画面中两种鹅对称分布，据考证，它们可能来自当时的希腊和土耳其。",1};
    name_list[8]={-1781,-1550,5,"古埃及河马","第二中间时期的墓葬中，湖蓝色珐琅质地的河马雕像。河马一度被古埃及人奉为神明，雄性河马有着强大的破坏性，相传古埃及历史上第一位法老就是被河马杀死的。雌性河马为保护子女表现出的勇气令人敬畏，因此生育女神Taweret的形象就是河马。河马雕塑被古埃及人视为驱散恶灵，帮助死者重生的灵物，它身上画的莲花图案也有重生的寓意。",1};
    name_list[9]={-945,-924,6,"古埃及舍顺克二世臂环","舍顺克二世是古埃及第二十二王朝的统治者，他的遗骸上戴着黄金面具，精美的胸饰以及一对由金子、宝石、肉红玉髓、白色珐琅和天青石制作的臂环。臂环上有着「荷鲁斯之眼」。相传鹰神荷鲁斯的左眼代表月亮，右眼代表太阳。荷鲁斯之眼作为陪葬饰物，有驱邪和保佑重生的寓意。",1};
    name_list[10]={-3600,-3400,4,"美索不达米亚泥板","在乌鲁克、乌尔、尼普尔等古老遗迹出土的大量楔形文字泥板，其两面以直线刻画出表示各种事物的符号，这是迄今发现的最早的文字。",1};
    name_list[11]={-2500,-2500,6,"美索不达米亚站立的男性崇拜者","这种雕像被放置在神庙中，代表放置雕像的人进行祈祷。雕像紧握的双手表示崇敬，而睁大的眼睛则表明雕像的主人在专心致志地听神祷告。苏美尔人认为，人存在于这些雕像中，因此可以永久地向他们的神灵祈祷。它证明了美索不达米亚人深厚的宗教信仰，即他们的万神殿控制着一切。",1};
    name_list[12]={-5000,-3000,5,"仰韶文化彩陶圆唇直口鼓腹罐","彩陶，采用泥片贴塑法、捏塑法和泥条盘筑法，直接在红陶上用颜料绘制花纹。之后再经烧制，让花纹附着在器物上。红陶需要氧化气氛，黑陶需要还原气氛（密封除氧），需烧制数个月。",1};
    name_list[13]={-2600,-2000,5,"龙山黑陶高柄豆","灰陶、红陶、黑陶，是烧制之后，器表直接呈现色彩。这是由原料泥土成分，以及烧制温度、环境、方法造成的。黑陶最大的特点，是快轮拉坯的制陶术。龙山陶器规整素雅，器形圆润，薄厚均匀，器表多打磨，甚至有复杂的镂空。其中最出色的工艺，甚至能制作出胎壁厚度在一毫米以下的蛋壳陶。",1};
    name_list[14]={-3000,-2000,4,"新石器时代打制石斧","从坚硬的石块上，用其它石块打下的石片或石核，可以制成尖状器、刮削器、砍砸器、雕刻器、球状器等。同时，人类开始创造壁画和珠宝首饰等艺术品，并开始从事如葬礼和仪式之类的宗教行为。",1};
    name_list[15]={-3000,-2000,4,"新石器时代磨制石刀","磨制石器，指表面磨光的石器，先将石材打制成适当形状，然后在砥石上研磨加工而成。因而在器物形态上有着更加细致的划分，出现了斧、锈、凿、刀、镶、簇等。精磨的石器有的可呈镜面状，石器中的斧、锛、铲、刀、镰、镞、矛头等器形，不但是青铜器的祖型，甚至影响到铁器。",1};
    name_list[16]={-1600,-1046,6,"商代金镯","东汉《说文解字》：“镯，钲也。从金，蜀声。”金指青铜，镯即是钲的别称，在当时并不指首饰，而是指一种乐器，形状似钟，以金属制成，古代军队在行军时用以击鼓。《周礼·地官·司徒》：“鼓人掌教六鼓四金之音声，……；以金镯击鼓，以金铙止鼓”",1};
    name_list[17]={-2070,-1600,6,"四坝文化铜耳环","甘肃河西走廊发掘的，种类有刀、削、锥、锛、矛、匕首、镞、耳环、指环、手镯、扣、泡、连珠饰、铜四羊首权杖头等。不仅用于装饰品，还用作工具，特别是用作消耗性武器，并有铸范石范出土，说明青铜的生产量较大。青铜不仅有锡青铜，还有铅青铜和铅锡青铜，已开始应用复合陶范分铸法铸造器物。",1};
    name_list[18]={-1046,-771,6,"西周青铜簋","远古的青铜器可以分为食器、酒器、水器、乐器四大类。食器中包括鼎、鬲（lì）等等。西周中晚期我国形成了列鼎制度，据《春秋公羊传》记载，天子用9鼎，诸侯用7鼎、卿大夫用5鼎、士用3鼎或1鼎。同时。与鼎一同出现的还有簋（guì），通常为九鼎八簋，七鼎六簋，五鼎四簋，三鼎二簋。",1};
    name_list[19]={-922,-878,5,"西周青铜鬲","鬲（lì）是一种炊煮器，“三足鼎立”，撑起一个如袋状的中空，以增大容量和受热面积。奴隶社会，青铜鬲为奴隶主们所独享，奴隶与贫民是绝不可能使用的，成为尊贵、权力的象征，获得者常常是世代相传，以表荣耀。最著名的是西周伯矩鬲，全称“牛头纹带盖伯矩鬲”，现藏于北京市首都博物馆。",1};
    name_list[20]={-1600,-1046,6,"商末青铜爵","饮酒器，象征地位，后用其称呼君主国家贵族封号。青铜爵与斝（jiǎ）、觚（gū）、尊、鼎等器物组成礼器群，在商周礼制的继承与发展过程中，成为中国古代青铜文明的核心之一。最著名的是青铜盂爵。其作器者盂（大臣），与国家博物馆藏大盂鼎的作器者为同一人，器身内壁有铭文4行21字，内容是有关周王举行祭礼并赏赐盂一事。",1};
    name_list[21]={-600,-550,6,"古希腊琥珀金金币","在钱币学领域，古希腊钱币是其中形成时间最早，发行范围最广，并且对后世钱币体系影响最为深刻的一支。希腊古风时期发行的钱币主要是用琥珀金、纯金和纯银打制，形状都呈不规则圆形和锭状，在钱币正面压制有图案，偶尔会有铭文，背面主要是锤打而成的方形戳印。",1};
    name_list[22]={-580,-460,5,"古希腊银币","希腊古典时期发行的钱币用琥珀金、金、银和青铜打制，在钱币正面压制有精美的浮雕头像。钱币的背面也开始出现以神话传说为背景的图案，雅典娜女神的头像代替了以往的女魔脸形。",1};
    name_list[23]={-460,-336,4,"古希腊青铜币","希腊罗马时期的钱币几乎都是青铜打制，并且它的图案风格更趋于背弃具有宗教色彩的题材，钱币上开始出现名人的形象、建筑、甚至是具有讽刺意味的题材等。币面非常平整，很薄，并且钱体很大，正面都压印有罗马帝国皇帝的肖像，在这个时期出现了刻有雕模师名字的钱币。",1};
    name_list[24]={-211,-82,6,"罗马奥里斯金币","奥里斯（AUREUS）这个词汇来源于拉丁文“AURUM”的词头“AUR”，意思是“黄金”。最著名的苏拉1奥里斯金币，公元前82年在苏拉随军造币场制造，重量10.72克。正面图案是罗马女神双翼盔头像，背面图案是苏拉赶四驾马车前行，上方胜利女神维多利亚用月桂环为其加冕，线下币文为“苏拉·最高统帅”",1};
    name_list[25]={-211,54,5,"罗马白银第纳尔","随着罗马军团击败了迦太基，原来属于迦太基的西班牙的大银矿也属于了罗马，罗马自此结束了缺乏银矿的历史。于是，挟带着消灭迦太基的胜利之威的罗马人，于公元前211年开始在全国统一发行白银第纳尔。",1};
    name_list[26]={54,270,3,"罗马白银第纳尔","白银第纳尔历经尼禄、图拉真、马可·奥勒留时期多次货币贬值，政府在铸币过程中，不改变铸币的面值，只减少铸币中的贵金属含量。这会促使人民将旧币熔解，将熔解后的贵金属送至铸币厂，以换取比原先更多的铸币，而国家则从贵金属流入量的增加额中获益。货币贬值的过程，是政府税收的主要来源。这种收益和税收就是所谓的铸币税。",1};
    name_list[27]={307,1453,6,"拜占庭金币","继戴克里先皇帝之后继任罗马帝国皇帝的君士坦丁大帝，上任伊始立即着手通过颁行一种名为金“索里得”（Solidus）的金币，这就是闻名于世的“拜占庭金币” （Bezant）。君士坦丁所发行的第一枚拜占庭金币重达4.55克，纯度为98%。拜占庭金币一直保持着不变的重量和纯度，是历史上发行得时间最长的金币。",1};
    name_list[28]={307,1453,6,"拜占庭金制饰品","拜占庭向欧洲出口极为精致的纺织品和以黄金打造的艺术品和奢侈品，以平衡拜占庭帝国长期以来与阿拉伯国家的贸易逆差和帝国的开销。拜占庭拥有世界历史上最杰出的金匠圣•埃卢瓦（全名圣•艾里基乌斯）。他被奉为众多行业的祖师爷，如金匠及铁匠的祖师爷，钱币收藏者及造币厂的祖师爷，皇家机电工程师的祖师爷，也是马的守护神。",1};
    name_list[29]={-50,200,3,"罗马彩色玻璃瓶","罗马城中玻璃制品十分普遍，价格十分低廉，一枚铜钱即可购买一只玻璃杯。豪华玻璃制品中有一种叫做“穆拉诺”的玻璃工艺，以淡紫色、深蓝色、宝石绿、黄赭色作为基本色，掺入乳白色、黄色、淡红色等制作而成。与此类似的还有一种叫做“热熔马赛克”的玻璃技艺，即将各色玻璃切成碎片再并在一起，在窑内加热烧制使之熔接。",1};
    name_list[30]={-50,200,5,"罗马万花玻璃瓶","“吹制法”在罗马境内的叙利亚和巴勒斯坦一带首先出现，“吹制法”玻璃的形态更加丰富，制作的玻璃质感更加透明，色彩更加细腻，工艺成本大大降低。将扭卷的各色玻璃合起来经过热熔形成棒，再将玻璃棒切断并置在器壁上，再经过热熔处理，使各色之间相互熔合，形成色彩斑斓而充满梦幻般的效果，还有用这种方法制作的玻璃碗。",1};
    name_list[31]={-2181,-1293,5,"古埃及圣甲虫护身符","圣甲虫因其滚球习性，与古埃及的太阳神凯布利联系密切，因此有一定的宗教意义。其制造的目的一般是用于活人佩戴。其形状一般是金龟子（常被认为是神圣粪金龟）。圣甲虫有较明显的头部、翅鞘和腿，不过腹部通常是扁平的，其上可能会刻有象形文字以作为印章。其大小不定，从数毫米到十数厘米的都有。 ",1};
    name_list[32]={-1570,-664,5,"古埃及心形圣甲虫","在古埃及，太阳神拉每天在半球形的天空巡回，转换生死。而金龟子将食物卷成球状并抱在怀中，埃及人将它们联系了起来，金龟子被当成了天球及重生的象征，被放到木乃伊的棺椁中，守护遗体。圣甲虫由石头或者陶器制成，常选择蓝绿的材质，或者也会涂上蓝色或绿色的釉。最常见的制造原料为皂石，也有紫水晶、玛瑙制成的圣甲虫。",1};
    name_list[33]={30,375,5,"古印度犍陀罗佛造像","犍陀罗是古印度十六列国之一，曾为古波斯帝国的一部分，希腊亚历山大帝国曾占领此地，阿育王也曾派佛教徒来此传播过佛教。犍陀罗佛造像仿照希腊、罗马雕刻神像的手法，以西方人体写实的形式雕刻佛像。其发髻多为波浪式，深目高鼻，穿着通肩大衣，具有浓厚的希腊化雕塑风格。其雕塑材质多为页片岩。",1};
    name_list[34]={30,375,5,"古印度秣菟罗佛造像","秣菟罗，意译为蜜善、孔雀，位于古印度南部，今新德里东南地区，恒河中游西北部，是古印度十六列国之一苏罗西那的首都，是贵霜王朝统治时期重要的佛教中心。其造像风格承继了传统印度的薄衣贴体、宽肩厚胸、螺发丰颊、波浪衣纹等造型特征，以印度本地人为模本，显现出人体的生命感和力量感。其材质多为黄斑点红砂岩。",1};
    name_list[35]={320,600,6,"古印度笈多时代秣菟罗佛造像","笈多王朝曾统治北印度、中印度及整个恒河流域，是印度佛教的全盛时期，同时也是佛教造像艺术的黄金时代。笈多风格吸收和继承了犍陀罗艺术风格和秣菟罗艺术风格，影响深远，中亚、东亚及东南亚地区的佛造像都深受其影响，中国佛造像也受到其深刻的影响。",1};
    name_list[36]={-600,-500,6,"古希腊黑绘陶器","黑绘风格的繁盛与希腊奴隶制民主政治的形成和发展的步伐是完全一致的。黑绘式是在赤色或黄褐色的陶壁上，用黑色作剪影式的描绘，而物体的内部结构则以刻线手法表现。这一时期的陶器装饰图案主要展示人类和神话活动，场景从日常生活到英雄事迹和荷马史诗，从神的世界到文艺体育。这一时期的主要描绘对象转移到了人。",1};
    name_list[37]={-530,-336,6,"古希腊红绘陶器","希腊文化日渐繁荣，艺术家们发现，把黑画红底反过来，能表现出更多细节。其效果较之黑纹样式的刻线显得更为灵活自如、丰富多彩。这种风格的发明，有助于绘饰者灵活自如地运用各种线条描绘人物动态、刻画人物神情，从而形成一种近似绘画的效果。",1};
    name_list[38]={-3000,400,6,"古埃及莎草纸文献","纸草文献是古代书写于纸莎草材料上的文献，又称纸莎草文献，其英文名“papyrus”为现代单词“paper”的词源。纸草以尼罗河三角洲的莎草科植物茎秆为原料，经截段、分层铺叠、挤压粘合、晾干打磨后制成页片，长篇幅文献需粘接成卷轴并附轴收纳，常存于陶罐或壁龛藏书洞内，内容涵盖契约、公文、书信及古典著作。",1};
    name_list[39]={-685,-476,6,"春秋晚期青铜鉴","春秋中晚期失蜡法的出现，使青铜艺术迈向了一个全新的境界，宴乐、骑射、狩猎及水陆攻战为题材的活动画像纹首次出现。出现了一批新奇清秀的器形，做工精雕细镂、玲珑剔透 、瑰丽典重，异常的典雅辉煌。春秋晚期流行有盖的附耳鼎，新出现了敦、缶（fǒu）、扁壶、鉴、杯、卮（zhī）等新颖的器物。",1};
    name_list[40]={-475,220,5,"战国时期动物饰牌","北方地区匈奴草原文化的遗存器物，主要为透雕动物铜饰牌，动物形首的青铜短刀、短剑、削及圆雕动物体的器物等，以及怪兽噬鹿、虎衔羊、虎噬马或驴、鹿、羊等小件动物铸制的腰带装饰品，雕饰生动而粗犷。制作时，表面经锉磨抛光后经过热处理，使青铜合金中的锡偏析与器表形成保护膜，因此其特征多为银灰色亮地子，表面锈蚀物较少。",1};
    name_list[41]={300,1000,6,"商代","",1};
    name_list[42]={300,1000,6,"商代","",1};
    name_list[43]={300,1000,6,"商代","",1};
    name_list[44]={300,1000,6,"商代","",1};
    name_list[45]={300,1000,6,"商代","",1};
    name_list[46]={300,1000,6,"商代","",1};
    name_list[47]={300,1000,6,"商代","",1};
    name_list[48]={300,1000,6,"商代","",1};
    name_list[49]={300,1000,6,"商代","",1};
    name_list[50]={300,1000,6,"商代","",1};

}

double Item::calculateTruePrice(Antique_goods antique)
{
    // 计算年份倍率（线性插值）
    double yearRange = antique.item.latest_year - antique.item.earliest_year;
    double yearFactor = 1.0;
    if (yearRange > 0) {
        double t = static_cast<double>(antique.year - antique.item.earliest_year) / yearRange;
        yearFactor = 1.2 - t * 0.4; // 从1.2线性变化到0.8
    }

    // 计算真实价格
    double true_price = antique.item.base_price *
                        rarity_rate[antique.item.rarity] *
                        yearFactor *
                        (antique.is_fake ? 0.2 : 1.0);

    // 保留4位有效数字
    return roundToSignificantDigits(true_price, 4);
}

// 在链表末尾添加古董
void Item::appendAntique(Antique_goods antique)
{
    antiqueList.push_back(antique);
}

// 删除指定id的古董
bool Item::removeAntiqueById(int id)
{
    auto it = std::find_if(antiqueList.begin(), antiqueList.end(),
                           [id](Antique_goods item) { return item.id == id; });

    if (it != antiqueList.end()) {
        antiqueList.erase(it);
        return true;
    }
    return false;
}

// 查找指定id的古董
Item::Antique_goods Item::findAntique(int id)
{
    auto it = std::find_if(antiqueList.begin(), antiqueList.end(),
                           [id](const Antique_goods& item) { return item.id == id; });

    if (it != antiqueList.end()) {
        return *it; // 返回找到的对象副本
    } else {
        // 返回一个特殊标记的无效对象
        return Antique_goods{
            -1,                    // id无效
            item_name{},           // 空item_name
            0, 0, 0.0, 0.0, false // 其他默认值
        };
    }
}

Item::Antique_goods Item::findAntique()
{
    if (antiqueList.empty()) {
        // 返回无效对象
        return Antique_goods{
            -1,                    // id无效
            item_name{},           // 空item_name
            0, 0, 0.0, 0.0, false // 其他默认值
        };
    }

    // 生成随机索引
    int randomIndex = QRandomGenerator::global()->bounded(static_cast<int>(antiqueList.size()));

    // 获取对应位置的迭代器
    auto it = antiqueList.begin();
    std::advance(it, randomIndex);

    return *it; // 返回对象副本
}

double Item::inventoryRate()
{
    return antiqueList.size() / max_list_size;
}

Item::Antique_goods Item::generateAntique()
{
    // 1. 获取年份范围
    int minYear = 2025 - reputation_to_year[attribute.reputation];
    int maxYear = 2025 - reputation_to_year[attribute.reputation - 1];

    // 2. 找出符合条件的项目
    QList<int> validIndices;
    for (int i = 0; i < 40; i++) {
        // 检查年份区间是否重叠
        if (name_list[i].earliest_year <= maxYear &&
            name_list[i].latest_year >= minYear) {
            validIndices.append(i);
        }
    }

    // 3. 随机选择一个项目
    int randomIndex = QRandomGenerator::global()->bounded(validIndices.size());
    item_name selectedItem = name_list[validIndices[randomIndex]];

    // 4. 生成随机年份
    int year = QRandomGenerator::global()->bounded(
        std::max(selectedItem.earliest_year, minYear),
        std::min(selectedItem.latest_year, maxYear) + 1
        );

    // 5. 随机生成状态
    int status = 0; // 默认"报废"
    double randVal = QRandomGenerator::global()->generateDouble(); // 生成0-1之间的随机数

    if (randVal < 0.1) {
        status = 0;      // "报废" 10%
    } else if (randVal < 0.2) {
        status = 1;      // "极差" 10%
    } else if (randVal < 0.3) {
        status = 2;      // "差" 10%
    } else if (randVal < 0.45) {
        status = 3;      // "一般" 15%
    } else if (randVal < 0.7) {
        status = 4;      // "良好" 25% (0.45-0.7)
    } else if (randVal < 0.9) {
        status = 5;      // "极佳" 20% (0.7-0.9)
    } else {
        status = 6;      // "完美" 10% (0.9-1.0)
    }

    // 6. 判断是否为赝品
    bool is_fake = (QRandomGenerator::global()->bounded(100) < 5);

    // 7. 创建临时对象用于计算价格
    Antique_goods temp{
        next_id++,        // id
        selectedItem,     // item
        year,             // year
        status,           // status
        0.0,              // true_price (临时值)
        -1.0,             // estimated_price (初始为-1)
        is_fake,          // is_fake
        false
    };

    // 8. 计算真实价格
    temp.true_price = calculateTruePrice(temp);
    temp.estimated_price = calculateEstimatedPricePlayer(temp.true_price, temp.item.rarity);

    // 9. 添加到链表
    appendAntique(temp);

    return temp;
}

double Item::modifyAntique(Antique_goods goods)
{
    // 1. 查找并修改链表中的元素
        auto it = std::find_if(antiqueList.begin(), antiqueList.end(),
                       [goods](const Antique_goods& item) {
                           return item.id == goods.id;
                       });

    if (it != antiqueList.end()) {
        // 2. 直接修改链表中的元素
        *it = goods;

        // 3. 重新计算价格（修改链表中的版本）
        it->true_price = calculateTruePrice(*it);

        return it->true_price;
    }

    // 4. 如果没找到，返回0或抛出异常
    return 0.0;
}

void Item::changeMaxListSize()
{
    max_list_size = 8 + (int(attribute.shop_level/2))*2;
}

double Item::calculateEstimatedPricePlayer(double basePrice, int rarity)
{
    QRandomGenerator* rand = QRandomGenerator::global();

    if (rand->bounded(10)>=5+attribute.ability-rarity)
        return -1;

    // 计算估值区间
    double maxFactor = std::max((15.0 + rarity - attribute.ability)/10.0,1.0);
    double minFactor = 1.0 / maxFactor;

    // 生成随机估值
    double random = rand->generateDouble();
    double factor = minFactor + random * (maxFactor - minFactor);
    double price = basePrice * factor;

    return price;
}

double Item::calculateEstimatedPriceExpert(double basePrice, int rarity, int expert_level)
{
    QRandomGenerator* rand = QRandomGenerator::global();

    if (rand->bounded(10)>=6+3*expert_level-rarity)
        return -1;

    return basePrice;
}
